
INCLUDE(FindPkgConfig)
pkg_check_modules(LIBWPG libwpg-0.1)
pkg_check_modules(LIBWPG_STREAM libwpg-stream-0.1)
pkg_check_modules(LIBWPD libwpd-0.8)
pkg_check_modules(LIBWPD_STREAM libwpd-stream-0.8)

IF(LIBWPG_FOUND AND LIBWPD_FOUND AND LIBWPD_STREAM_FOUND AND LIBWPG_STREAM_FOUND)
  INCLUDE_DIRECTORIES(
    ${CMAKE_SOURCE_DIR}
    ${CMAKE_SOURCE_DIR}/scribus
    ${LIBWPG_INCLUDE_DIRS}
    ${LIBWPD_INCLUDE_DIRS}
    ${LIBWPD_STREAM_INCLUDE_DIRS}
  )

  SET(IMPORTWPG_PLUGIN_MOC_CLASSES
    importwpg.h
    importwpgplugin.h
  )

  SET(IMPORTWPG_PLUGIN_SOURCES
    importwpg.cpp
    importwpgplugin.cpp
  )

  SET(SCRIBUS_IMPORTWPG_PLUGIN "importwpg")

  QT4_WRAP_CPP(IMPORTWPG_PLUGIN_MOC_SOURCES ${IMPORTWPG_PLUGIN_MOC_CLASSES})

  ADD_LIBRARY(${SCRIBUS_IMPORTWPG_PLUGIN} MODULE ${IMPORTWPG_PLUGIN_SOURCES} ${IMPORTWPG_PLUGIN_MOC_SOURCES})

  TARGET_LINK_LIBRARIES(${SCRIBUS_IMPORTWPG_PLUGIN} ${PLUGIN_LIBRARIES} ${LIBWPG_LDFLAGS} ${LIBWPG_STREAM_LDFLAGS} ${LIBWPD_LDFLAGS} ${LIBWPD_STREAM_LDFLAGS})

  INSTALL(TARGETS ${SCRIBUS_IMPORTWPG_PLUGIN}
    LIBRARY
    DESTINATION ${PLUGINDIR}
    PERMISSIONS ${PLUGIN_PERMISSIONS}
  )

  ADD_DEPENDENCIES(${SCRIBUS_IMPORTWPG_PLUGIN} ${EXE_NAME})
ENDIF(LIBWPG_FOUND AND LIBWPD_FOUND AND LIBWPD_STREAM_FOUND AND LIBWPG_STREAM_FOUND)
